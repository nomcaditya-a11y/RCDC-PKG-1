<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genus Power RCDC Dashboard</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link rel="icon" type="image/png" href="https://genuspower.com/wp-content/uploads/2022/07/genus-favicon.png" sizes="192x192" />
<link rel="apple-touch-icon" href="https://genuspower.com/wp-content/uploads/2022/07/genus-favicon.png" />    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

   <header class="top-nav">
        <div class="logo-area">
            <img src="js/logo.webp" alt="Logo" class="dashboard-logo">
            <h1>Reconnection Disconnection for CSPDCL <span>(PKG-1 & PKG-3)</span></h1>
        </div>
        
        <div class="header-controls">
            <div class="pkg-switcher">
                <button id="btn-pkg1" class="pkg-btn active" onclick="switchPackage('pkg1')">PKG-1</button>
                <button id="btn-pkg3" class="pkg-btn" onclick="switchPackage('pkg3')">PKG-3</button>
            </div>
            <button onclick="refreshData()" class="btn-secondary refresh-btn" title="Refresh Data">ðŸ”„ Refresh</button>
            <button id="theme-btn" onclick="toggleTheme()" class="btn-secondary refresh-btn" title="Toggle Dark Mode">ðŸŒ™</button>
            
            <button id="export-dash-btn" onclick="exportFullDashboardPDF()" class="btn-primary" style="height: 38px; padding: 0 15px; display: flex; align-items: center; gap: 5px;">
                ðŸ“„PDF
            </button>
        </div>
        
        <div id="connection-status" class="status-badge">ðŸŸ¡ Connecting...</div>
    </header>

    <div class="container">
        <section class="box global-filters">
            <div class="filter-grid">
                <div class="input-group">
                    <label>Region</label>
                    <select id="filter-region"><option value="ALL">All</option></select>
                </div>
                <div class="input-group">
                    <label>Circle</label>
                    <select id="filter-circle"><option value="ALL">All</option></select>
                </div>
                <div class="input-group">
                    <label>Division</label>
                    <select id="filter-division"><option value="ALL">All</option></select>
                </div>
                <div class="input-group">
                    <label>Zone/DC</label>
                    <select id="filter-zone"><option value="ALL">All</option></select>
                </div>
                
                <div class="input-group date-group">
                    <label>Disconnection Date Range</label>
                    <div class="date-inputs">
                        <input type="date" id="filter-start">
                        <span>to</span>
                        <input type="date" id="filter-end">
                    </div>
                </div>
                <span> </span>
                <div class="btn-group">
                    <button id="apply-filters" class="btn-primary">Apply Filters</button>
                    <button id="reset-filters" class="btn-secondary">Reset</button>
                </div>
            </div>
        </section>

      <section class="kpi-grid">
    
    <div class="card kpi-card border-blue" onclick="downloadKPIData('total')" title="Click to download CSV" style="display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px 10px;">
        <p class="kpi-title" style="white-space: nowrap;">Total Disconnection</p>
        <h3 id="kpi-total" class="kpi-value">0</h3>
        <div class="kpi-sub-stats" id="sub-total" style="white-space: nowrap;"></div>
    </div>

    <div class="card kpi-card border-green" onclick="downloadKPIData('reconnected')" title="Click to download CSV" style="display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px 10px;">
        <p class="kpi-title" style="white-space: nowrap;">Reconnected</p>
        <h3 id="kpi-reconnected" class="kpi-value text-green">0</h3>
        <div class="kpi-sub-stats" id="sub-recon" style="white-space: nowrap;"></div>
    </div>

    <div class="card kpi-card border-red" onclick="downloadKPIData('disconnected')" title="Click to download CSV" style="display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px 10px;">
        <p class="kpi-title" style="white-space: nowrap;">Still Disconnected</p>
        <h3 id="kpi-disconnected" class="kpi-value text-red">0</h3>
        <div class="kpi-sub-stats" id="sub-disc" style="white-space: nowrap;"></div>
    </div>

    <div class="card kpi-card" onclick="downloadKPIData('lrcf')" title="Click to download CSV" style="display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px 10px; border-top: 4px solid #8b5cf6;">
        <p class="kpi-title" style="white-space: nowrap;">LRCF</p>
        <h3 id="kpi-lrcf" class="kpi-value" style="color: #8b5cf6;">0</h3>
        <div class="kpi-sub-stats" id="sub-lrcf" style="white-space: nowrap;"></div>
    </div>

    <div class="card kpi-card border-yellow" onclick="downloadKPIData('pending')" title="Click to download CSV" style="display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px 10px;">
        <p class="kpi-title" style="white-space: nowrap;">Pending</p>
        <h3 id="kpi-pending" class="kpi-value text-yellow">0</h3>
        <div class="kpi-sub-stats" id="sub-pend" style="white-space: nowrap;"></div>
    </div>

    <div class="card kpi-card" style="display: flex; flex-direction: column; justify-content: center; border-top: 4px solid #6366f1; padding: 15px;">
        <h3 style="text-align: center; font-size: 0.9rem; color: #475569; letter-spacing: 1px; margin-bottom: 15px; text-transform: uppercase;">TODAY'S ACTIVITY</h3>
        
        <div style="display: flex; justify-content: space-around; align-items: center; text-align: center; width: 100%;">
            
            <div onclick="downloadTodayData('disc')" style="cursor: pointer; padding: 8px; border-radius: 8px; transition: 0.2s; width: 50%;" title="Click to download Excel data" onmouseover="this.style.backgroundColor='#f1f5f9'" onmouseout="this.style.backgroundColor='transparent'">
                <h4 style="font-size: 0.7rem; color: #94a3b8; font-weight: 700; white-space: nowrap;">DISC. ðŸ“¥</h4>
                <p id="kpi-today-disc" style="font-size: 1.8rem; font-weight: bold; color: #f97316; margin: 5px 0;">0</p>
                <div id="sub-today-disc" style="font-size: 0.7rem; color: #64748b; white-space: nowrap;">Cell: 0 | RF: 0</div>
            </div>
            
            <div style="width: 1px; background-color: #e2e8f0; height: 50px;"></div>
            
            <div onclick="downloadTodayData('req')" style="cursor: pointer; padding: 8px; border-radius: 8px; transition: 0.2s; width: 50%;" title="Click to download Excel data" onmouseover="this.style.backgroundColor='#f1f5f9'" onmouseout="this.style.backgroundColor='transparent'">
                <h4 style="font-size: 0.7rem; color: #94a3b8; font-weight: 700; white-space: nowrap;">RC incl. backlogsðŸ“¥</h4>
                <p id="kpi-today-req" style="font-size: 1.8rem; font-weight: bold; color: #0ea5e9; margin: 5px 0;">0</p>
                <div id="sub-today-req" style="font-size: 0.7rem; color: #64748b; white-space: nowrap;">Cell: 0 | RF: 0</div>
            </div>
        </div>
    </div>
</section>
        <section class="box" id="export-trend">
            <div class="box-header">
                <div class="section-title title-yellow">Disconnection vs Reconnection Trends</div>
                <div class="export-btns">
                    <button onclick="exportBoxData('trend', 'csv')">CSV</button>
                    <button onclick="exportBoxData('trend', 'pdf', 'export-trend')">PDF</button>
                </div>
            </div>
            <div class="canvas-wrapper" style="height: 400px;">
                <canvas id="trendChart"></canvas>
            </div>
        </section>

        <section class="charts-grid">
            <div class="box chart-box" id="export-region">
                <div class="box-header">
                    <div class="section-title title-blue" id="dynamic-chart-title">Region Wise Disconnection</div>
                    <div class="export-btns">
                        <button onclick="exportBoxData('region', 'csv')">CSV</button>
                        <button onclick="exportBoxData('region', 'pdf', 'export-region')">PDF</button>
                    </div>
                </div>
                <div class="canvas-wrapper"><canvas id="regionChart"></canvas></div>
            </div>

            <div class="box chart-box" id="export-comm">
                <div class="box-header">
                    <div class="section-title title-red">Still Disconnected Analysis - Comm Status</div>
                    <div class="export-btns">
                        <button onclick="exportBoxData('comm', 'csv')">CSV</button>
                        <button onclick="exportBoxData('comm', 'pdf', 'export-comm')">PDF</button>
                    </div>
                </div>
                <div class="canvas-wrapper"><canvas id="commStatusChart"></canvas></div>
            </div>
        </section>

        <section class="tables-grid">
            <div class="box table-box" id="export-prog">
                <div class="box-header">
                    <div class="section-title title-green" id="dynamic-progress-title">DCRC Progress</div>
                    <div class="export-btns">
                        <button onclick="exportBoxData('progress', 'csv')">CSV</button>
                        <button onclick="exportBoxData('progress', 'pdf', 'export-prog')">PDF</button>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="data-table" id="progress-table">
                        <thead></thead><tbody></tbody>
                    </table>
                </div>
            </div>

            <div class="box table-box" id="export-aging">
                <div class="box-header">
                    <div class="section-title title-orange" id="dynamic-aging-title">Aging Analysis</div>
                    <div class="export-btns">
                        <button onclick="exportBoxData('aging', 'csv')">CSV</button>
                        <button onclick="exportBoxData('aging', 'pdf', 'export-aging')">PDF</button>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="data-table" id="aging-table">
                        <thead></thead><tbody></tbody>
                    </table>
                </div>
            </div>
        </section>

        <section class="box map-section" id="export-map">
            <div class="box-header">
                <div class="section-title title-purple">Geographical Meter Distribution</div>
            </div>
            <div class="map-controls">
                <div class="map-filter">
                    <label>Zone:</label>
                    <select id="map-zone-filter"><option value="ALL">All Available Zones</option></select>
                </div>
                <div class="map-filter">
                    <label>Aging:</label>
                    <select id="map-aging-filter"><option value="ALL">All Available Aging</option></select>
                </div>
                <div class="map-filter">
                    <label>Comm Status:</label>
                    <select id="map-comm-filter">
                        <option value="ALL">All</option>
                        <option value="NonComm" selected>Non-Communicating</option>
                        <option value="Comm">Communicating</option>
                    </select>
                </div>
            </div>
            <div id="map" class="modern-map"></div>
        </section>
        
    </div>

    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="js/api.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
















