<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genus Power RCDC Dashboard</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link rel="icon" type="image/png" href="https://genuspower.com/wp-content/uploads/2022/07/genus-favicon.png" sizes="192x192" />
<link rel="apple-touch-icon" href="https://genuspower.com/wp-content/uploads/2022/07/genus-favicon.png" />    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

   <header class="top-nav">
        <div class="logo-area">
            <img src="js/logo.webp" alt="Logo" class="dashboard-logo">
            <h1>Reconnection Disconnection for CSPDCL <span>(PKG-1 & PKG-3)</span></h1>
        </div>
        
        <div class="header-controls">
            <div class="pkg-switcher">
                <button id="btn-pkg1" class="pkg-btn active" onclick="switchPackage('pkg1')">PKG-1</button>
                <button id="btn-pkg3" class="pkg-btn" onclick="switchPackage('pkg3')">PKG-3</button>
            </div>
            <button onclick="refreshData()" class="btn-secondary refresh-btn" title="Refresh Data">ðŸ”„ Refresh</button>
            <button id="theme-btn" onclick="toggleTheme()" class="btn-secondary refresh-btn" title="Toggle Dark Mode">ðŸŒ™</button>
            
            <button id="export-dash-btn" onclick="exportFullDashboardPDF()" class="btn-primary" style="height: 38px; padding: 0 15px; display: flex; align-items: center; gap: 5px;">
                ðŸ“„ Export PDF
            </button>
        </div>
        
        <div id="connection-status" class="status-badge">ðŸŸ¡ Connecting...</div>
    </header>

    <div class="container">
        <section class="box global-filters">
            <div class="filter-grid">
                <div class="input-group">
                    <label>Region</label>
                    <select id="filter-region"><option value="ALL">All</option></select>
                </div>
                <div class="input-group">
                    <label>Circle</label>
                    <select id="filter-circle"><option value="ALL">All</option></select>
                </div>
                <div class="input-group">
                    <label>Division</label>
                    <select id="filter-division"><option value="ALL">All</option></select>
                </div>
                <div class="input-group">
                    <label>Zone/DC</label>
                    <select id="filter-zone"><option value="ALL">All</option></select>
                </div>
                
                <div class="input-group date-group">
                    <label>Disconnection Date Range</label>
                    <div class="date-inputs">
                        <input type="date" id="filter-start">
                        <span>to</span>
                        <input type="date" id="filter-end">
                    </div>
                </div>
                <span> </span>
                <div class="btn-group">
                    <button id="apply-filters" class="btn-primary">Apply Filters</button>
                    <button id="reset-filters" class="btn-secondary">Reset</button>
                </div>
            </div>
        </section>

        <section class="kpi-grid">
            <div class="card kpi-card border-blue" onclick="downloadKPIData('total')" title="Click to download CSV">
                <p class="kpi-title">Total Disconnection</p>
                <h3 id="kpi-total" class="kpi-value">0</h3>
                <div class="kpi-sub-stats" id="sub-total"></div>
            </div>
            <div class="card kpi-card border-green" onclick="downloadKPIData('reconnected')" title="Click to download CSV">
                <p class="kpi-title">Reconnected</p>
                <h3 id="kpi-reconnected" class="kpi-value text-green">0</h3>
                <div class="kpi-sub-stats" id="sub-recon"></div>
            </div>
            <div class="card kpi-card border-red" onclick="downloadKPIData('disconnected')" title="Click to download CSV">
                <p class="kpi-title">Still Disconnected</p>
                <h3 id="kpi-disconnected" class="kpi-value text-red">0</h3>
                <div class="kpi-sub-stats" id="sub-disc"></div>
            </div>
            <div class="card kpi-card border-yellow" onclick="downloadKPIData('pending')" title="Click to download CSV">
                <p class="kpi-title">Pending</p>
                <h3 id="kpi-pending" class="kpi-value text-yellow">0</h3>
                <div class="kpi-sub-stats" id="sub-pend"></div>
            </div>
           <div class="card kpi-card border-orange" onclick="downloadKPIData('today-disc')" title="Click to download CSV">
                <p class="kpi-title">Today Disconnected</p>
                <h3 id="kpi-today-disc" class="kpi-value text-orange">0</h3>
                <div class="kpi-sub-stats" id="sub-today-disc"></div>
            </div>

            <div class="card kpi-card border-purple" onclick="downloadKPIData('today-recon')" title="Click to download CSV">
                <p class="kpi-title">Today Reconnected</p>
                <h3 id="kpi-today-recon" class="kpi-value text-purple">0</h3>
                <div class="kpi-sub-stats" id="sub-today-recon"></div>
            </div>
        </section>

        <section class="box" id="export-trend">
            <div class="box-header">
                <div class="section-title title-yellow">Disconnection vs Reconnection Trends</div>
                <div class="export-btns">
                    <button onclick="exportBoxData('trend', 'csv')">CSV</button>
                    <button onclick="exportBoxData('trend', 'pdf', 'export-trend')">PDF</button>
                </div>
            </div>
            <div class="canvas-wrapper" style="height: 400px;">
                <canvas id="trendChart"></canvas>
            </div>
        </section>

        <section class="charts-grid">
            <div class="box chart-box" id="export-region">
                <div class="box-header">
                    <div class="section-title title-blue" id="dynamic-chart-title">Region Wise Disconnection</div>
                    <div class="export-btns">
                        <button onclick="exportBoxData('region', 'csv')">CSV</button>
                        <button onclick="exportBoxData('region', 'pdf', 'export-region')">PDF</button>
                    </div>
                </div>
                <div class="canvas-wrapper"><canvas id="regionChart"></canvas></div>
            </div>

            <div class="box chart-box" id="export-comm">
                <div class="box-header">
                    <div class="section-title title-red">Still Disconnected Analysis - Comm Status</div>
                    <div class="export-btns">
                        <button onclick="exportBoxData('comm', 'csv')">CSV</button>
                        <button onclick="exportBoxData('comm', 'pdf', 'export-comm')">PDF</button>
                    </div>
                </div>
                <div class="canvas-wrapper"><canvas id="commStatusChart"></canvas></div>
            </div>
        </section>

        <section class="tables-grid">
            <div class="box table-box" id="export-prog">
                <div class="box-header">
                    <div class="section-title title-green" id="dynamic-progress-title">DCRC Progress</div>
                    <div class="export-btns">
                        <button onclick="exportBoxData('progress', 'csv')">CSV</button>
                        <button onclick="exportBoxData('progress', 'pdf', 'export-prog')">PDF</button>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="data-table" id="progress-table">
                        <thead></thead><tbody></tbody>
                    </table>
                </div>
            </div>

            <div class="box table-box" id="export-aging">
                <div class="box-header">
                    <div class="section-title title-orange" id="dynamic-aging-title">Aging Analysis</div>
                    <div class="export-btns">
                        <button onclick="exportBoxData('aging', 'csv')">CSV</button>
                        <button onclick="exportBoxData('aging', 'pdf', 'export-aging')">PDF</button>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="data-table" id="aging-table">
                        <thead></thead><tbody></tbody>
                    </table>
                </div>
            </div>
        </section>

        <section class="box map-section" id="export-map">
            <div class="box-header">
                <div class="section-title title-purple">Geographical Meter Distribution</div>
            </div>
            <div class="map-controls">
                <div class="map-filter">
                    <label>Zone:</label>
                    <select id="map-zone-filter"><option value="ALL">All Available Zones</option></select>
                </div>
                <div class="map-filter">
                    <label>Aging:</label>
                    <select id="map-aging-filter"><option value="ALL">All Available Aging</option></select>
                </div>
                <div class="map-filter">
                    <label>Comm Status:</label>
                    <select id="map-comm-filter">
                        <option value="ALL">All</option>
                        <option value="NonComm" selected>Non-Communicating</option>
                        <option value="Comm">Communicating</option>
                    </select>
                </div>
            </div>
            <div id="map" class="modern-map"></div>
        </section>
        
    </div>

    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="js/api.js"></script>
    <script src="js/main.js"></script>
</body>
</html>




